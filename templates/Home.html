{% extends 'base.html' %}
{% block title %}UPBIT AutoTrading Â· ë©”ì¸ ëŒ€ì‹œë³´ë“œ{% endblock %}
{% block content %}

<div id="layout">
  <!-- ì¢Œì¸¡ -->
  <div id="left">
    <div class="card shadow-sm mb-4 status-card">
      <div class="card-head">
        <i class="bi bi-robot"></i> ë´‡ ìƒíƒœ
        <i class="bi bi-question-circle ms-auto" data-bs-toggle="tooltip" data-bs-custom-class="wide-tooltip"
           title="ë´‡ì´ ì‹¤í–‰ ì¤‘ì¸ì§€ í‘œì‹œí•©ë‹ˆë‹¤. ì‹¤í–‰ ìƒíƒœì—ì„œëŠ” ì„¤ì •í•œ ëª¨ë“  ì „ëµì´ ìë™ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤."></i>
      </div>
      <div class="card-body">
        <div class="mb-2">
          <span class="me-2">í˜„ì¬ ìƒíƒœ:</span>
          <span id="bot-state">
            {% if running %}
              <span class="status-icon status-running">ğŸŸ©</span>
            {% else %}
              <span class="status-icon status-stopped">ğŸŸ¨</span>
            {% endif %}
          </span>
        </div>
        <div class="mb-2 text-end">
          <button id="botActionBtn"
                  class="btn {% if running %}btn-danger{% else %}btn-primary{% endif %} btn-sm min-w-140"
                  data-api="{{ '/api/stop-bot' if running else '/api/start-bot' }}">
            {% if running %}ë´‡ ì¤‘ì§€{% else %}ë´‡ ì‹œì‘{% endif %}
          </button>
        </div>
        <small class="text-muted" id="webStart">{{ start_time }} [{{ uptime }}]</small>
      </div>
    </div>
    <div class="card shadow-sm mb-4">
      <div class="card-head">
        <i class="bi bi-wallet2"></i> ê³„ì¢Œ ìš”ì•½
        <i class="bi bi-question-circle ms-auto" data-bs-toggle="tooltip" data-bs-custom-class="wide-tooltip"
           title="ë³´ìœ  í˜„ê¸ˆ, ì´ ìì‚°, ëˆ„ì  ìˆ˜ìµë¥ ì„ ìš”ì•½í•´ ë³´ì—¬ ì¤ë‹ˆë‹¤."></i>
      </div>
      <div class="card-body">
        <div class="row gy-2">
          <div class="col-6">í˜„ê¸ˆ:</div>
          <div class="col-6 text-end fw-semibold" id="accountCash">{{ account.cash|comma }} ì›</div>
          <div class="col-6">ì´ ìì‚°:</div>
          <div class="col-6 text-end fw-semibold" id="accountTotal">{{ account.total|comma }} ì›</div>
          <div class="col-6">ëˆ„ì  ìˆ˜ìµë¥ :</div>
          <div class="col-6 text-end text-success fw-semibold" id="accountPnl">{{ account.pnl }} %</div>
        </div>
      </div>
    </div>
    <div class="card shadow-sm mb-4">
      <div class="card-head">
        <i class="bi bi-filter-square"></i> ëª¨ë‹ˆí„°ë§ ì½”ì¸ ì¡°ê±´
        <i class="bi bi-question-circle ms-auto" data-bs-toggle="tooltip" data-bs-custom-class="wide-tooltip"
           title="ê°€ê²©ê³¼ 24ì‹œê°„ ê±°ë˜ëŒ€ê¸ˆ ìˆœìœ„ë¥¼ ì„¤ì •í•´ ê´€ì‹¬ ì½”ì¸ ëª©ë¡ì„ ì¢í ìˆ˜ ìˆìŠµë‹ˆë‹¤."></i>
      </div>
      <div class="card-body">
        <form id="coinFilterForm">
          <div class="form-group d-flex align-items-center mb-2">
            <label class="form-label me-2 mb-0">ìµœì†Œ ê°€ê²©(ì›)</label>
            <input type="number" class="form-control form-control-sm"
                   name="min_price" value="{{ config.get('min_price', 0) }}">
          </div>
          <div class="form-group d-flex align-items-center mb-2">
            <label class="form-label me-2 mb-0">ìµœëŒ€ ê°€ê²©(ì›)</label>
            <input type="number" class="form-control form-control-sm"
                   name="max_price" value="{{ config.get('max_price', 0) }}">
          </div>
          <div class="form-group d-flex align-items-center mb-3">
            <label class="form-label me-2 mb-0">24ì‹œê°„ ê±°ë˜ëŒ€ê¸ˆ ìˆœìœ„</label>
            <input type="number" class="form-control form-control-sm"
                   name="rank" value="{{ config.get('rank', 0) }}">
          </div>
          <button type="button" class="btn btn-primary btn-sm w-100" data-api="/api/save-settings">ì €ì¥</button>
        </form>
      </div>
    </div>

  </div><!-- /left -->

  <div id="drag-left"></div>

  <!-- ì¤‘ì•™ -->
  <div id="center">
    <!-- ë³´ìœ ì½”ì¸ ê´€ë¦¬(ë§¤ë„ ëª¨ë‹ˆí„°ë§) + ì†ì ˆÂ·ìµì ˆ/ì¶”ì„¸ ê·¸ë˜í”„ -->
    <div class="card shadow-sm mb-5">
      <div class="card-head">
        <i class="bi bi-cash-coin"></i> ë³´ìœ ì½”ì¸ ê´€ë¦¬ (ë§¤ë„ ëª¨ë‹ˆí„°ë§)
        <span id="balanceTimer" class="remain-time"></span>
        <i id="btnExcludedList" class="bi bi-list-ul ms-auto" role="button"
           data-bs-toggle="tooltip" data-bs-custom-class="wide-tooltip"
           title="ë§¤ìˆ˜Â·ë§¤ë„ ëŒ€ìƒì—ì„œ ì œì™¸ëœ ì½”ì¸ ëª©ë¡ì„ í™•ì¸í•©ë‹ˆë‹¤."></i>
        <i class="bi bi-question-circle ms-2" data-bs-toggle="tooltip" data-bs-custom-class="wide-tooltip"
           title="ë³´ìœ  ì½”ì¸ì˜ ì†ìµë¥ ê³¼ ë§¤ë„ ìš°ì„ ìˆœìœ„ë¥¼ í™•ì¸í•˜ê³  ìˆ˜ë™ ë§¤ë„ë„ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."></i>
        <i class="ms-2 bi bi-arrow-clockwise reload-btn" role="button" data-refresh="balances"
           data-bs-toggle="tooltip" data-bs-custom-class="wide-tooltip" title="í‘œì‹œëœ ë°ì´í„°ë¥¼ ì¦‰ì‹œ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤."></i>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-bordered text-center align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th>ì½”ì¸</th>
                <th>ë§¤ë§¤ ì „ëµ</th>
                <th>ì œì™¸</th>
                  <th>ìˆ˜ìµë¥ 
                    <i class="bi bi-exclamation-circle" data-bs-toggle="tooltip" data-bs-custom-class="wide-tooltip"
                       title="í˜„ì¬ê¹Œì§€ í™•ì •ëœ ìˆ˜ìµë¥ ê³¼ ë¯¸ì‹¤í˜„ ìˆ˜ìµë¥ ì„ í•©ì‚°í•´ ë³´ì—¬ ì¤ë‹ˆë‹¤."></i>
                  </th>
                  <th>ì†ì ˆ Â· ìµì ˆ Â· ì¶”ì„¸ìµì ˆ
                    <i class="bi bi-exclamation-circle" data-bs-toggle="tooltip" data-bs-custom-class="wide-tooltip"
                       title="ì„¤ì •ëœ ì†ì ˆÂ·ìµì ˆ ê°€ê²©ê³¼ í˜„ì¬ê°€ì˜ ìƒëŒ€ ìœ„ì¹˜ë¥¼ í•œëˆˆì— í‘œì‹œí•©ë‹ˆë‹¤."></i>
                  </th>
                  <th>Sell ì‹œê·¸ë„
                    <i class="bi bi-exclamation-circle" data-bs-toggle="tooltip" data-bs-custom-class="wide-tooltip"
                       title="ì—¬ëŸ¬ ì½”ì¸ ë³´ìœ  ì‹œ ì–´ë–¤ ì¢…ëª©ì„ ë¨¼ì € ë§¤ë„í• ì§€ ìš°ì„ ìˆœìœ„ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤."></i>
                  </th>
                  <th>ì•¡ì…˜
                    <i class="bi bi-exclamation-circle" data-bs-toggle="tooltip" data-bs-custom-class="wide-tooltip"
                       title="ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ì¦‰ì‹œ ì‹œì¥ê°€ë¡œ ë§¤ë„ ì£¼ë¬¸ì„ ë³´ëƒ…ë‹ˆë‹¤."></i>
                  </th>
              </tr>
            </thead>
            <tbody id="positionBody">
              {% for p in positions %}
              <tr>
                <td>{{ p.coin }}</td>
                <td>{% if running %}{{ p.strategy }}{% else %}ìˆ˜ë™ ë§¤ë§¤{% endif %}</td>
                <td>
                  <button class="btn btn-sm btn-outline-primary text-dark"
                          data-api="/api/exclude-coin" data-coin="{{ p.coin }}">ì œì™¸</button>
                </td>
                <td>
                  {% if p.pnl is not none %}
                    <span class="badge {{ 'badge-profit' if p.pnl >= 0 else 'badge-loss' }}">
                      {{ '%+.1f'|format(p.pnl) }}%
                    </span>
                  {% else %}
                    <span class="text-muted">ë°ì´í„° ì—†ìŒ</span>
                  {% endif %}
                </td>
                <td>
                  <div class="se-bar">
                  <span class="dot stop"></span>
                    <span class="dot entry" data-pos="{{ p.entry_pct }}"></span>
                    <span class="dot take"></span>
                    {% if p.pin_pct is not none %}
                      <span class="pin" data-pos="{{ p.pin_pct }}"></span>
                    {% endif %}
                  </div>
                  <div class="trend-bar mt-1">
                    <span class="tick tick1"></span>
                    <span class="tick tick2"></span>
                    <span class="dot trend {{ p.trend_color }}" data-pos="{{ p.trend }}"></span>
                  </div>
                </td>
                <td><span class="badge badge-{{ p.signal }}">{{ p.signal_label }}</span></td>
                <td>
                  <button class="btn btn-sm btn-outline-danger"
                          data-api="/api/manual-sell"
                          data-confirm="ì‹œì¥ê°€ë¡œ ë§¤ë„ ìš”ì²­ì„ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?"
                          data-coin="{{ p.coin }}">ìˆ˜ë™ ë§¤ë„</button>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <!-- ë§¤ìˆ˜ ëª¨ë‹ˆí„°ë§ -->
    <div class="card shadow-sm">
      <div class="card-head">
        <i class="bi bi-bullseye"></i> ë§¤ìˆ˜ ëª¨ë‹ˆí„°ë§
        <span id="signalTimer" class="remain-time"></span>
        <i class="bi bi-question-circle ms-auto" data-bs-toggle="tooltip" data-bs-custom-class="wide-tooltip"
           title="ì—¬ëŸ¬ ì§€í‘œë¥¼ ì¢…í•©í•´ ì‹¤ì‹œê°„ ë§¤ìˆ˜ ìš°ì„ ìˆœìœ„ë¥¼ ê³„ì‚°í•´ í‘œì‹œí•©ë‹ˆë‹¤."></i>
        <i class="ms-2 bi bi-arrow-clockwise" role="button" data-refresh="signals"
           data-bs-toggle="tooltip" data-bs-custom-class="wide-tooltip" title="í‘œì‹œëœ ë°ì´í„°ë¥¼ ì¦‰ì‹œ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤."></i>
      </div>
      <div class="table-responsive">
        <table class="table table-bordered text-center mb-0">
          <thead class="table-light"><tr>
            <th>ì½”ì¸</th>
            <th>í˜„ì¬ê°€</th>
              <th>ì¶”ì„¸
              <i class="bi bi-info-circle" data-bs-toggle="tooltip"
                 data-bs-custom-class="wide-tooltip"
                 title="ì¶”ì„¸ ì˜ë¯¸: EMA5/20/60 ë°°ì—´ê³¼ ê¸°ìš¸ê¸°ë¥¼ í™œìš©í•´ ê°€ê²© íë¦„ì„ íŒë‹¨í•©ë‹ˆë‹¤.&#10;
ğŸ”¼(ìƒìŠ¹): EMA5>EMA20>EMA60 ì´ê³  EMA20 ê¸°ìš¸ê¸° ì–‘ìˆ˜&#10;
ğŸ”¸(ì¤‘ë¦½): ìœ„ ë‘ ì¡°ê±´ì— ëª¨ë‘ í•´ë‹¹í•˜ì§€ ì•ŠìŒ&#10;
ğŸ”»(í•˜ë½): EMA5<EMA20<EMA60 ì´ê³  EMA20 ê¸°ìš¸ê¸° ìŒìˆ˜"></i>
            </th>
            <th>ë³€ë™ì„±<br>(ATR%)
              <i class="bi bi-info-circle" data-bs-toggle="tooltip"
                 data-bs-custom-class="wide-tooltip"
                 title="ë³€ë™ì„± ì˜ë¯¸: ATR ë¹„ìœ¨ë¡œ ê°€ê²© ì›€ì§ì„ì„ íŒë‹¨í•©ë‹ˆë‹¤.&#10;ğŸ”µ(ë†’ìŒ): 5% ì´ìƒ&#10;ğŸŸ¡(ì¤‘ê°„): 1~5%&#10;ğŸ”»(ë‚®ìŒ): 1% ë¯¸ë§Œ"></i>
            </th>
            <th>ê±°ë˜ëŸ‰(%)
              <i class="bi bi-info-circle" data-bs-toggle="tooltip"
                 data-bs-custom-class="wide-tooltip"
                 title="ê±°ë˜ëŸ‰ ì˜ë¯¸: í‰ê·  ëŒ€ë¹„ ì¦ê°€ìœ¨ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.&#10;â«(í­ì¦): 2ë°° ì´ìƒ&#10;ğŸ”¼(ì¦ê°€): 1.10~1.99ë°°&#10;ğŸ”»(ê°ì†Œ): 0.70ë°° ë¯¸ë§Œ"></i>
            </th>
            <th>ì²´ê²°ê°•ë„
              <i class="bi bi-info-circle" data-bs-toggle="tooltip"
                 data-bs-custom-class="wide-tooltip"
                 title="ì²´ê²°ê°•ë„ ì˜ë¯¸: ë§¤ìˆ˜/ë§¤ë„ ë¹„ì¤‘ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.&#10;â«(ê°•ë§¤ìˆ˜): 120 ì´ìƒ&#10;ğŸ”¼(ë§¤ìˆ˜ìš°ìœ„): 105~119&#10;ğŸ”»(ë§¤ë„ìš°ìœ„): 95 ë¯¸ë§Œ"></i>
            </th>
            <th>GC
              <i class="bi bi-info-circle" data-bs-toggle="tooltip"
                 data-bs-custom-class="wide-tooltip"
                 title="GC ì˜ë¯¸: EMA êµì°¨ë¡œ ì¶”ì„¸ ì „í™˜ì„ í™•ì¸í•©ë‹ˆë‹¤.&#10;ğŸ”¼(ê³¨ë“ ): ê³¨ë“ í¬ë¡œìŠ¤&#10;ğŸ”»(ë°ë“œ): ë°ë“œí¬ë¡œìŠ¤&#10;ğŸ”¸(ì—†ìŒ): êµì°¨ ì—†ìŒ"></i>
            </th>
            <th>RIS
              <i class="bi bi-info-circle" data-bs-toggle="tooltip"
                 data-bs-custom-class="wide-tooltip"
                 title="RIS: RSI ìˆ˜ì¹˜ ê¸°ì¤€&#10;â«<20&#10;ğŸ”¼20~30&#10;ğŸ”¸30~70&#10;ğŸ”»>70"></i>
            </th>
            <th>Buy ì‹œê·¸ë„
              <i class="bi bi-info-circle" data-bs-toggle="tooltip"
                 data-bs-custom-class="wide-tooltip"
                 title="ì‹œê·¸ë„ ì˜ë¯¸: ë³µí•© ì§€í‘œë¡œ ë§¤ìˆ˜ ê°•ë„ë¥¼ ë¶„ë¥˜í•©ë‹ˆë‹¤.&#10;1ë‹¨ê³„: ë§¤ìˆ˜ ê°•í•¨&#10;2ë‹¨ê³„: ë§¤ìˆ˜ ìš°ì„¸&#10;3ë‹¨ê³„: ê´€ë§&#10;4ë‹¨ê³„: íšŒí”¼Â·ê¸ˆì§€"></i>
            </th>
            <th>ì•¡ì…˜</th>
          </tr></thead>
          <tbody id="signalBody">
            {% for s in signals %}
            <tr>
              <td>{{ s.coin }}</td>
              <td>{{ s.price }}</td>
              <td class="icon-cell">{{ s.trend }}</td>
              <td class="icon-cell">{{ s.volatility }}</td>
              <td class="icon-cell">{{ s.volume }}</td>
              <td class="icon-cell">{{ s.strength }}</td>
              <td class="icon-cell">{{ s.gc }}</td>
              <td class="icon-cell">{{ s.rsi }}</td>
              <td><span class="badge badge-{{ s.signal_class }}">{{ s.signal }}</span></td>
              <td>
                <button class="btn btn-sm btn-outline-success"
                        data-api="/api/manual-buy" data-coin="{{ s.coin }}">ìˆ˜ë™ ë§¤ìˆ˜</button>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div><!-- /center -->

  <div id="drag-right"></div>

  <!-- ìš°ì¸¡ -->
  <div id="right">
    <div class="card shadow-sm h-100">
      <div class="card-head">
        <i class="bi bi-bell"></i> ì‹¤ì‹œê°„ ì•Œë¦¼
        <i class="bi bi-question-circle ms-auto" data-bs-toggle="tooltip" data-bs-custom-class="wide-tooltip"
           title="ë§¤ë§¤ ì²´ê²°, ì†ì ˆÂ·ìµì ˆ ë°œìƒ ë“± ì£¼ìš” ì•Œë¦¼ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ í‘œì‹œí•©ë‹ˆë‹¤."></i>
      </div>
      <div id="liveAlerts" class="card-body small live-alerts">
        {% if alerts %}
        {% for a in alerts %}
        <div>[{{ a.time }}] {{ a.message }}</div>
        {% endfor %}
        {% else %}
        <div class="text-muted">ì‹¤ì‹œê°„ ì•Œë¦¼ ëŒ€ê¸°ì¤‘......</div>
        {% endif %}
      </div>
    </div>
  </div><!-- /right -->
</div><!-- /layout -->

{% endblock %}
