{% extends 'base.html' %}
{% block title %}알림 설정 - AUTO UPBIT{% endblock %}
{% block content %}
<div class="grid gap-6">
    <div class="bg-gray-800 p-7 rounded-2xl shadow">
        <h2 class="card-title mb-4">매수 설정</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
                <label class="block mb-1">매수 금액</label>
                <input id="entry-size" type="number"
                       class="w-full p-2 rounded bg-gray-900 border border-gray-700"
                       placeholder="0">
            </div>
            <div>
                <label class="block mb-1">최대 보유 코인 수</label>
                <input id="max-symbols" type="number"
                       class="w-full p-2 rounded bg-gray-900 border border-gray-700"
                       placeholder="0">
            </div>
        </div>
        <button id="save-buy-settings"
                class="mt-4 px-4 py-2 rounded bg-green-600 text-sm">저장</button>
    </div>
    <div class="bg-gray-800 p-7 rounded-2xl shadow">
        <h2 class="card-title mb-4">텔레그램 알림 설정</h2>
        <label class="flex items-center gap-2 mb-2">
            <input id="tg-start" type="checkbox" class="w-4 h-4"> 시스템 기동/중지
        </label>
        <label class="flex items-center gap-2 mb-2">
            <input id="tg-buy" type="checkbox" class="w-4 h-4"> 매수 모니터링
        </label>
        <label class="flex items-center gap-2 mb-2">
            <input id="tg-order" type="checkbox" class="w-4 h-4"> 매수, 매도 주문체결
        </label>
        <label class="flex items-center gap-2 mb-2">
            <input id="tg-alert" type="checkbox" class="w-4 h-4"> 시스템 알림
        </label>
        <label class="flex items-center gap-2 mb-2">
            <input id="tg-ml" type="checkbox" class="w-4 h-4"> F5 머신러닝 감시
        </label>
        <button id="save-alarm-settings" class="mt-4 px-4 py-2 rounded bg-green-600 text-sm">저장</button>
    </div>
    <div class="bg-gray-800 p-7 rounded-2xl shadow">
        <h2 class="card-title mb-4">텔레그램 원격</h2>
        <label class="toggle-switch">
            <input type="checkbox" class="" id="remote-toggle">
            <span class="toggle-slider">
                <span class="icon">&#9654;</span>
                <span class="icon" style="display:none;">&#9632;</span>
                <span class="toggle-dot"></span>
            </span>
        </label>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function loadBuySettings() {
    fetch('/api/buy_settings')
        .then(r => r.json())
        .then(d => {
            document.getElementById('entry-size').value = d.ENTRY_SIZE_INITIAL || 0;
            document.getElementById('max-symbols').value = d.MAX_SYMBOLS || 0;
            /* deprecated fields removed */
        });
}
loadBuySettings();
document.getElementById('save-buy-settings').onclick = function () {
    const data = {
        ENTRY_SIZE_INITIAL: Number(document.getElementById('entry-size').value),
        MAX_SYMBOLS: Number(document.getElementById('max-symbols').value)
    };
    fetch('/api/buy_settings', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
    });
};

function loadAlarmSettings() {
    fetch('/api/alarm_config')
        .then(r => r.json())
        .then(d => {
            document.getElementById('tg-start').checked = d.system_start_stop;
            document.getElementById('tg-buy').checked = d.buy_monitoring;
            document.getElementById('tg-order').checked = d.order_execution;
            document.getElementById('tg-alert').checked = d.system_alert;
            document.getElementById('tg-ml').checked = d.ml_pipeline;
        });
}
loadAlarmSettings();
document.getElementById('save-alarm-settings').onclick = function () {
    const data = {
        system_start_stop: document.getElementById('tg-start').checked,
        buy_monitoring: document.getElementById('tg-buy').checked,
        order_execution: document.getElementById('tg-order').checked,
        system_alert: document.getElementById('tg-alert').checked,
        ml_pipeline: document.getElementById('tg-ml').checked
    };
    fetch('/api/alarm_config', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
    });
};
</script>
{% endblock %}
