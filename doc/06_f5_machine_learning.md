# F5 머신러닝 총괄 로직

이 문서는 `f5_ml_pipeline` 폴더 전체를 아우르는 **F5 단계**의 흐름을 간략히
설명합니다. 초보 기획자도 파이프라인 구조를 이해할 수 있도록 스크립트 간
연계와 로그 위치를 중심으로 정리했습니다.

## 역할

- 원시 1분봉 데이터를 정제하고 각종 지표를 계산해 학습용 데이터셋을 만듭니다.
- 라벨링과 데이터 분할 후 LightGBM 모델을 학습·평가합니다.
- 예측 결과로 간단한 백테스트를 수행하고 성과가 좋은 전략을 자동 선정합니다.
- 전체 과정은 `run_pipeline.py` 한 파일에서 순차적으로 실행할 수 있습니다.

## 사용되는 관련 파일

| 파일 | 설명 |
| --- | --- |
| `f5_ml_pipeline/run_pipeline.py` | 모든 단계를 순서대로 호출하는 진입점 |
| `f5_ml_pipeline/*_*.py` | 각 단계별 세부 스크립트 |
| `f5_ml_pipeline/ml_data/` | 단계별 산출물이 저장되는 공통 폴더 |
| `logs/F5_*.log` | 단계별 실행 로그가 기록되는 위치 |

## 사용되는 함수

- `run_step(step, index, total)` – 주어진 스크립트를 실행하고 진행률을 출력합니다.【F:f5_ml_pipeline/run_pipeline.py†L25-L36】
- `main()` – 파이프라인 전체를 실행하며 시작/종료 시 텔레그램 알림을 보냅니다.【F:f5_ml_pipeline/run_pipeline.py†L39-L65】

## 동작 흐름

1. `PIPELINE_STEPS` 목록에 정의된 스크립트들을 순서대로 실행합니다.
2. 각 단계는 자신의 디렉터리 기준으로 절대 경로를 사용하므로 실행 위치와
   관계없이 동일한 폴더 구조에 결과가 저장됩니다.
3. 시작과 종료 시점에 `ExceptionHandler.send_alert()`가 호출되어 텔레그램으로
   진행 상황을 알립니다.
4. 스크립트 실패 시 즉시 중단되며 마지막으로 완료된 단계까지의 로그는
   `logs/` 폴더에서 확인할 수 있습니다.
5. 디버그 모드에서 실행할 경우 Flask 리로더가 두 번째 프로세스를 생성하므로
   파이프라인 스케줄러가 중복 실행될 수 있습니다. `app.py`는
   `WERKZEUG_RUN_MAIN` 환경 변수를 확인하여 실제 프로세스에서만 스케줄러를
   시작해 텔레그램 알림이 한 번만 전송되도록 합니다.

## 로그 위치 및 설명

- 단계별 로그 파일은 `logs/` 하위에 `F5_<step>.log` 형식으로 생성됩니다.
- 예를 들어 `06_train.py` 실행 기록은 `logs/F5_ml_train.log`에서 확인합니다.
- `run_pipeline.py` 자체의 진행 상황은 터미널 출력으로만 표시되며 별도 파일을
  남기지 않습니다.

F5 파이프라인 산출물은 모두 `f5_ml_pipeline/ml_data/` 하위에 저장되므로,
필요한 단계의 파일을 참조해 모델 학습이나 전략 평가 결과를 확인할 수 있습니다.
